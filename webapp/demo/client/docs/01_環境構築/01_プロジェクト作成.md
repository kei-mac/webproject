# 環境構築
クライアント側処理の環境構築手順を以下に記載する。
手順の概要は以下とする。
- [環境構築](#環境構築)
  - [1. 事前準備](#1-事前準備)
    - [1.1 package.json のインストール](#11-packagejson-のインストール)
  - [2. TypeScript・webpack のインストール](#2-typescriptwebpack-のインストール)
    - [2.1 TypeScriptのインストール](#21-typescriptのインストール)
    - [2.2 TypeScriptのインストール](#22-typescriptのインストール)
    - [2.3 webpack のカスタマイズ](#23-webpack-のカスタマイズ)
  - [3. TypeScriptの実行](#3-typescriptの実行)
    - [3.1 エントリポイントの指定](#31-エントリポイントの指定)
    - [3.2 ローダの設定](#32-ローダの設定)
    - [3.3 インポートの効率化](#33-インポートの効率化)
    - [3.4 出力先の設定](#34-出力先の設定)
    - [3.5 環境設定](#35-環境設定)
  - [4. TypeScriptの動作確認](#4-typescriptの動作確認)
    - [4.1 TypeScriptの設定](#41-typescriptの設定)
    - [4.2 TypeScriptの記述](#42-typescriptの記述)
    - [4.3 ビルドの設定](#43-ビルドの設定)


## 1. 事前準備
### 1.1 package.json のインストール
以下のコマンドをターミナルで実行する。

※ -y オプションを付ければ、単に `npm init` を実行したときに答えなきゃいけない ”yes問答” を全スキップできる

    npm init -y

## 2. TypeScript・webpack のインストール
### 2.1 TypeScriptのインストール
プロジェクトへ`typescript` と `webpack` （ + 関連パッケージ）をインストールします。
先に、typescript だけインストールします。
以下のコマンドを実行します。

    npm install -D typescript


プロジェクトに次のファイル追加／編集がされれば、成功です。

### 2.2 TypeScriptのインストール
webpack をはじめとした次のパッケージをインストールします。
 - webpack：モジュールバンドラー
 - webpack-cli：ターミナル上で webpack を実行するためのツール
 - ts-loader：TypeScript 用ローダ

以下のコマンドを実行します。

    npm install -D webpack webpack-cli ts-loader

### 2.3 webpack のカスタマイズ
プロジェクトで TypeScript が使えるように webpack を細かく設定します。
 - ルートディレクトリに`webpack.config.js`を作成します。
 
 今回は、`\demo\client`に作成し、以下のテンプレートをコピーします。

```TypeScript
const path = require('path')   // Node.js の `path` モジュール（ファイルパス操作の関数を提供）を読み込み

module.exports = {
    // ココにカスタマイズしたい内容を記述していく
}
```
これで、webpack をカスタマイズしていくための雛形が完成したので、中身を埋めていきます。<br>具体的には、次の設定が必要です。
- エントリポイントの指定
- ローダの設定
- インポートの効率化
- 出力先の設定
- 環境の設定


## 3. TypeScriptの実行
TypeScriptのビルドの設定を行い、実行できるようにします。

### 3.1 エントリポイントの指定
entry：エントリポイント（wecpack がモジュールをまとめてバンドルをつくるとき、そのモジュールの依存関係の解析を開始するファイル）を指定・作成します。
<br>具体的には、`webpack.config.js`を次の記述をします。
<br> 　※ 今回は、ファイル名：login.tsに設定します。

```TypeScript
const path = require('path')

module.exports = {
    entry: './src/components/core/login.ts' // 任意でTypeScriptファイル名を指定してください。
}
```
指定したエントリポイントに合うように、main ディレクトリへ typescript（任意の名前）ディレクトリを、そしてそのtypescript ディレクトリに login.ts（任意の名前）ファイルを作成します。

### 3.2 ローダの設定
ローダ（wecpack が TypeScript のファイルをすべてロードするとき、そのロード対象の拡張子 .ts や、使うローダの指定など）を設定します。
<br>具体的には、`webpack.config.js`を次の記述をします。

```TypeScript
const path = require('path')

module.exports = {
    entry: './src/components/core/login.ts',
    module: {
        rules: [
            {
             test: /\.ts$/,
             use: 'ts-loader',   // package.json にインストール済み
             exclude: /node_modules/,   // `exclude`の理由：パフォーマンスの最適化・・・通常、`node_modules`内のファイルはトランスパイルの必要がないため、`exclude`処理でビルドプロセスから除外
            },
        ],
    }
}
```

### 3.3 インポートの効率化
インポートの効率化として、拡張子を省略できる（Ex：エントリポイントへのインポート時）ようにします。
<br>具体的には、`webpack.config.js`を次の記述をします。

```TypeScript
const path = require('path')

module.exports = {
    entry: './src/components/core/login.ts',
    module: {
        rules: [
            {
             test: /\.ts$/,
             use: 'ts-loader',
             exclude: /node_modules/,
            },
        ],
    },
    // 以下を追記
    resolve: {
        extensions: ['.ts', '.js']
    } 
}
```

### 3.4 出力先の設定
wecpack が作成したバンドルの出力先を設定します。
<br>具体的には、`webpack.config.js`を次の記述をします。

```TypeScript
const path = require('path')

module.exports = {
    entry: './src/components/core/login.ts',
    module: {
        rules: [
            {
             test: /\.ts$/,
             use: 'ts-loader',
             exclude: /node_modules/,
            },
        ],
    },
    resolve: {
        extensions: ['.ts', '.js']
    },
    // 以下を追記
    output: {
        filename: 'bundle.js',
        path: path.resolve(__dirname, '../src/main/resources/static/javascript'), // クライアント側のリソースを配置するフォルダパスを指定してください。
    },
}
```

※ output の各要素は、次の意味を持ちます。
- `bundle.js`：出力先となるJavaScriptファイル***
- `path`：1行目で読み込んだ、Node.js の path モジュール
- `resolve`：path モジュールが持つ resolve 関数（引数に渡されたパスから絶対パスを生成する）の呼び出し`__dirname：Node.js`のグローバル変数で、現在実行中のスクリプト（今回は `webpack.config.js`）が存在するディレクトリの絶対パスを表す。
- `src/main/resources/static/javascript`：出力先となるJavaScriptファイル、つまり、`bundle.js`が存在するディレクトリ***の相対パスを表す。*** `bundle.js` ファイルと `javascript/` ディレクトリは、あとでおこなうコマンド操作時に自動で生成されるので、自作しなくてOK

### 3.5 環境設定
コマンドを実行したときに、警告を非表示にするために、環境を設定しておきます。
<br>今回は「開発環境」を想定し、次の記述をします。

```TypeScript
const path = require('path')

module.exports = {
    entry: './src/components/core/login.ts',
    module: {
        rules: [
            {
             test: /\.ts$/,
             use: 'ts-loader',
             exclude: /node_modules/,
            },
        ],
    },
    resolve: {
        extensions: ['.ts', '.js']
    },
    output: {
        filename: 'bundle.js',
        path: path.resolve(__dirname, 'src/main/resources/static/javascript'),
    },
    // 以下を追加
    mode: 'development',
}
```

## 4. TypeScriptの動作確認
### 4.1 TypeScriptの設定
TypeScript をプロジェクトへ本格的に組み込んでいきます。
<br>具体的には、次の実装が必要です。
 - TypeScriptの設定
 - TypeScriptの記述
 - Webページでの描画確認

具体的なTypeScriptを書いていく前に、TypeScript 自体の設定をします。
<br> 以下のコマンドをターミナルで実行してください。

    npx tsc --init

追加された `tscinfig.json` の中身を見てください。
<br>次の"compilerOptions"というハッシュ配列の中で、以下をコメントアウトしてください（その他デフォルトでコメントアウトが外れていたキー／バリューは、基本的に外しっぱなしでOK）

```json
{
  "compilerOptions": {
    "target": "es2016",
    "module": "commonjs",
    "sourceMap": true,
    "outDir": "./dist",
    "esModuleInterop": true
    "strict": true
  }
}
```

次に、`tscinfig.json`に、"include"と"exclude"という配列を追加します。

```json
{
  "compilerOptions": {
    "target": "es2016",
    "module": "commonjs",
    "sourceMap": true,
    "outDir": "./dist",
    "esModuleInterop": true
    "strict": true
  },
  // 以下追加  
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules"]    /* パフォーマンスの最適化：通常、`node_modules`内のファイルはトランスパイルの必要がないため、`exclude`によりビルドプロセスから除外 */
}
```

### 4.2 TypeScriptの記述
実際に簡単なTypeScriptを書いていきます。
<br>具体的には、導入の準備で用意したindex.html上のdivタグに、”Hello World”といった好きな文字列を表示させるためのTypeScriptを記述します。
<br>`/src/components/core/`ディレクトリ、つまり、`login.ts`と同じディレクトリに`ModelLogin.ts`（任意の名前）を作成します。
<br>続けて、作成した.tsファイルを次のように編集します。

```TypeScript
export default class Greeting {
    phrase: string;
    
    constructor(phrase: string) {
        this.phrase = phrase
    }
    
    public sayPhrase(element: HTMLElement | null){
        if(element) {
            element.innerText = this.phrase
        }
    }
}
```

次に、index.htmlを次のように編集します。
```HTML
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Top</title>
    </head>
    <body>
        <h1>Welcome!</h1>
        <p>Lorem Ipsum</p>
        <div id="demo"></div>   <!-- 追加 -->
    </body>
</html>
```

`login.ts`（エントリポイント）を次のように編集します。

```TypeScript
import Greeting from "./model/ModelLogin";

const demo: HTMLElement | null = document.getElementById("demo");

const phrase = new Greeting("Hello world");

phrase.sayPhrase(demo);
```

### 4.3 ビルドの設定
TypeScriptをトランスパイルした結果をstaticディレクトリにJavaScriptファイル bundle.jsとして出力するために、package.jsonの"scripts"を次のように編集します。

```json
{
  "name": "client",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "directories": {
    "doc": "docs"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack" // 追加
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "ts-loader": "^9.5.1",
    "typescript": "^5.6.2",
    "webpack": "^5.95.0",
    "webpack-cli": "^5.1.4"
  }
}
```

プロジェクトのstaticディレクトリに、以下のディレクトリ／ファイルが追加されれば、成功です。`javascript/bundle.js`
続けて、index.htmlの`<body>`内を次のように編集します。
```HTML
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Top</title>
    </head>
    <body>
        <h1>Welcome!</h1>
        <p>Lorem Ipsum</p>
        <div id="demo"></div>   
        <script src="/javascript/bundle.js"></script>   <!-- 追加 -->
    </body>
</html>
```
この追記によって、DOMに変換されたHTMLにJavaScriptが装飾されるようになります。